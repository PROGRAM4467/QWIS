<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Buat Kuis - Quiz Interaktif</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <button class="mode-toggle" onclick="toggleMode()">ðŸŒ™</button>

  <div class="container">
    <div class="card">
      <h2>Buat Kuis Baru</h2>
      <label for="jumlahSoal">Jumlah Soal:</label>
      <input type="number" id="jumlahSoal" min="1" placeholder="Masukkan jumlah soal">
      <button class="btn btn-primary" onclick="buatForm()">Buat Form Soal</button>
    </div>

    <form id="formSoal"></form>

    <div id="kodeKuisCard" class="card" style="display:none; text-align:center;">
      <h3>Kode Kuis Kamu</h3>
      <div id="kodeKuis" class="kode"></div>
      <button class="btn btn-success" onclick="balikBeranda()">Kembali ke Beranda</button>
    </div>
  </div>

  <div id="toast" class="toast"></div>

  <script>
    // Theme
    const savedColor = localStorage.getItem("themeColor");
    if (savedColor) document.documentElement.style.setProperty("--theme-color", savedColor);
    if (localStorage.getItem("darkMode") === "true") document.body.classList.add("dark");
    const device = localStorage.getItem("device");
    if (device) document.body.classList.add(device + "-mode");

    function toggleMode() {
      document.body.classList.toggle("dark");
      localStorage.setItem("darkMode", document.body.classList.contains("dark"));
    }

    function showToast(msg) {
      const toast = document.getElementById("toast");
      toast.innerText = msg;
      toast.className = "toast show";
      setTimeout(() => { toast.className = toast.className.replace("show", ""); }, 2500);
    }

    function buatForm() {
      const jumlah = parseInt(document.getElementById("jumlahSoal").value);
      const form = document.getElementById("formSoal");
      form.innerHTML = "";

      if (!jumlah || jumlah < 1) {
        showToast("Jumlah soal harus lebih dari 0");
        return;
      }

      for (let i = 1; i <= jumlah; i++) {
        form.innerHTML += `
          <div class="card soalCard">
            <h3>Soal ${i}</h3>
            <textarea placeholder="Tulis pertanyaan..." class="pertanyaan" required></textarea>
            <label>Tipe Soal:</label>
            <select class="tipe" onchange="ubahTipe(this)">
              <option value="pg">Pilihan Ganda</option>
              <option value="isian">Isian</option>
            </select>
            <div class="opsiBox">
              <label>Pilihan A:</label>
              <input type="text" class="opsi" placeholder="Opsi A">
              <label>Pilihan B:</label>
              <input type="text" class="opsi" placeholder="Opsi B">
              <label>Pilihan C:</label>
              <input type="text" class="opsi" placeholder="Opsi C">
              <label>Pilihan D:</label>
              <input type="text" class="opsi" placeholder="Opsi D">
            </div>
            <label>Kunci Jawaban:</label>
            <input type="text" class="kunci" placeholder="Contoh: A / teks jawaban">
          </div>
        `;
      }
      form.innerHTML += `<button type="button" class="btn btn-primary" onclick="simpanKuis(${jumlah})">Selesai & Simpan</button>`;
    }

    function ubahTipe(select) {
      const card = select.closest(".soalCard");
      const opsiBox = card.querySelector(".opsiBox");
      if (select.value === "isian") {
        opsiBox.style.display = "none";
      } else {
        opsiBox.style.display = "block";
      }
    }

    function simpanKuis(jumlah) {
      const soalList = [];
      const cards = document.querySelectorAll("#formSoal .soalCard");
      cards.forEach(card => {
        const pertanyaan = card.querySelector(".pertanyaan").value;
        const tipe = card.querySelector(".tipe").value;
        const kunci = card.querySelector(".kunci").value;
        const opsi = [];

        if (tipe === "pg") {
          card.querySelectorAll(".opsi").forEach(o => opsi.push(o.value));
        }

        soalList.push({ pertanyaan, tipe, kunci, opsi });
      });

      const kode = Math.random().toString(36).substring(2, 8).toUpperCase();
      localStorage.setItem("kuis_" + kode, JSON.stringify(soalList));

      document.getElementById("kodeKuis").innerText = kode;
      document.getElementById("kodeKuisCard").style.display = "block";
      document.getElementById("formSoal").innerHTML = "";
      showToast("Kuis berhasil dibuat!");
    }

    function balikBeranda() {
      window.location.href = "beranda.html";
    }
  </script>
</body>
</html>
